import{g as r,o as i,b as e,i as f,t as u,F as v,m as D,p as C,q as B,s as _,e as w,c as j,x as S,y as H,a as m,d as b,h as I,w as k,k as A,z as L,f as P}from"./app-DYjFnMqP.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as U}from"./AuthenticatedLayout-DwBeea5S.js";import"./SecureCloudFile-trYpLogj.js";const V={props:{searchQuery:{type:String,default:""}},data(){return{files:[],loading:!1,error:null,deletingId:null,fileToDelete:null,pagination:{current_page:1,last_page:1,per_page:15,total:0,from:0,to:0},mimeTypeMap:{"application/pdf":"PDF","application/msword":"DOC","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"DOCX","application/vnd.ms-excel":"XLS","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"XLSX","application/vnd.oasis.opendocument.text":"ODT","image/jpeg":"JPG","image/png":"PNG","text/plain":"TXT"}}},watch:{searchQuery(){this.fetchFiles(1)}},mounted(){this.fetchFiles()},methods:{async fetchFiles(n=1){var o;this.loading=!0,this.error=null;try{let c=`/files?page=${n}`;this.searchQuery&&(c+=`&search=${encodeURIComponent(this.searchQuery)}`);const a=await fetch(c,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content")},credentials:"same-origin"});if(!a.ok){this.error=`Failed to load files: ${a.statusText}`;return}const t=await a.json();this.files=t.data,this.pagination={current_page:t.current_page,last_page:t.last_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to}}catch{this.error="Error fetching files."}finally{this.loading=!1}},changePage(n){n>=1&&n<=this.pagination.last_page&&this.fetchFiles(n)},getFileExtension(n){return this.mimeTypeMap[n]||n.split("/").pop().toUpperCase()},formatSize(n){if(n===0)return"0 Bytes";const o=1024,c=["Bytes","KB","MB","GB","TB"],a=Math.floor(Math.log(n)/Math.log(o));return parseFloat((n/Math.pow(o,a)).toFixed(2))+" "+c[a]},formatDate(n){return new Date(n).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},formatFullDate(n){return new Date(n).toLocaleString()},promptDelete(n){this.fileToDelete=n,this.$refs.confirmDialog.showModal()},async onConfirm(){var o,c;this.$refs.confirmDialog.close(),this.deletingId=this.fileToDelete;const n=C();try{await B.delete(`/files/${this.fileToDelete}`),n.success("File deleted successfully!"),this.fetchFiles(this.pagination.current_page)}catch(a){this.error=((c=(o=a.response)==null?void 0:o.data)==null?void 0:c.message)||"Error deleting file."}finally{this.deletingId=null,this.fileToDelete=null}},onCancel(){this.$refs.confirmDialog.close(),this.fileToDelete=null}}},E={class:"files-container"},N={ref:"confirmDialog",class:"confirm-dialog"},X={class:"dialog-actions"},q={key:0,class:"status-message"},z={key:1,class:"status-message error"},R={key:2,class:"files-list"},$={class:"file-info"},Q=["href"],Z={class:"file-meta"},O={class:"tag"},G={class:"tag"},Y=["title"],K={class:"file-actions"},J=["href","download"],W=["onClick","disabled","title"],ee={key:0},te={key:1},oe={key:3,class:"pagination-wrapper"},se={class:"pagination"},ne=["disabled"],ae=["disabled"],ie={class:"pagination-info"},le=["disabled"],re=["disabled"],de={class:"pagination-summary"},ce={key:4,class:"status-message"};function pe(n,o,c,a,t,d){return i(),r("div",E,[e("dialog",N,[o[6]||(o[6]=e("p",null,"Are you sure you want to delete this file?",-1)),e("div",X,[e("button",{onClick:o[0]||(o[0]=(...s)=>d.onConfirm&&d.onConfirm(...s)),class:"confirm-btn"},"Yes"),e("button",{onClick:o[1]||(o[1]=(...s)=>d.onCancel&&d.onCancel(...s)),class:"cancel-btn"},"No")])],512),t.loading?(i(),r("div",q,"Loading files...")):f("",!0),t.error?(i(),r("div",z,u(t.error),1)):f("",!0),!t.loading&&t.files.length?(i(),r("ul",R,[(i(!0),r(v,null,D(t.files,s=>(i(),r("li",{key:s.id,class:"file-item"},[e("div",$,[e("a",{href:`/files/${s.id}/download`,target:"_blank",rel:"noopener",class:"file-name"},u(s.original_name),9,Q),e("div",Z,[e("span",O,u(d.formatSize(s.size)),1),e("span",G,u(d.getFileExtension(s.mime_type)),1),e("span",{class:"tag tag-date",title:d.formatFullDate(s.created_at)},u(d.formatDate(s.created_at)),9,Y)])]),e("div",K,[e("a",{href:`/files/${s.id}/download`,download:s.original_name,target:"_blank",rel:"noopener",class:"btn btn-download",title:"Download"}," Download ",8,J),e("button",{onClick:h=>d.promptDelete(s.id),class:"delete-btn",disabled:t.deletingId===s.id,title:"Delete "+s.original_name},[t.deletingId===s.id?(i(),r("span",ee,"Deleting...")):(i(),r("span",te,"Delete"))],8,W)])]))),128))])):f("",!0),t.pagination.last_page>1?(i(),r("div",oe,[e("nav",se,[e("button",{onClick:o[2]||(o[2]=s=>d.changePage(1)),disabled:t.pagination.current_page===1,class:"pagination-btn"},"First",8,ne),e("button",{onClick:o[3]||(o[3]=s=>d.changePage(t.pagination.current_page-1)),disabled:t.pagination.current_page===1,class:"pagination-btn"},"Previous",8,ae),e("span",ie,"Page "+u(t.pagination.current_page)+" of "+u(t.pagination.last_page),1),e("button",{onClick:o[4]||(o[4]=s=>d.changePage(t.pagination.current_page+1)),disabled:t.pagination.current_page===t.pagination.last_page,class:"pagination-btn"},"Next",8,le),e("button",{onClick:o[5]||(o[5]=s=>d.changePage(t.pagination.last_page)),disabled:t.pagination.current_page===t.pagination.last_page,class:"pagination-btn"},"Last",8,re)]),e("div",de," Showing "+u(t.pagination.from)+" to "+u(t.pagination.to)+" of "+u(t.pagination.total)+" files ",1)])):f("",!0),!t.loading&&t.files.length===0?(i(),r("div",ce,"No files found.")):f("",!0)])}const ue=x(V,[["render",pe],["__scopeId","data-v-32e91f22"]]);function ge(n,o){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"})])}function he(n,o){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function fe(n,o){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function me(n,o){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function _e(n,o){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}const ve={class:"mt-6 gap-4"},we={class:"flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-gray-700 mr-4"},xe={class:"flex-1"},ye={class:"text-sm font-medium truncate"},be={class:"text-xs text-gray-500"},ke=["onClick"],De=["disabled"],Ce={__name:"FileUploadForm",emits:["close-dialog"],setup(n,{emit:o}){const c=C(),a=_([]),t=o,d=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/png","image/jpeg","application/vnd.oasis.opendocument.text"];function s(p){let l=Array.from(p.target.files);if(a.value.length+l.length>5){c.error("You can upload maximum 5 files at a time.");return}l.forEach(g=>{if(!d.includes(g.type)){c.error(`File type not allowed: ${g.name}`);return}a.value.push(g)})}function h(p){const g={target:{files:Array.from(p.dataTransfer.files)}};s(g)}function F(p){a.value.splice(p,1)}function M(p){switch(p.name.split(".").pop().toLowerCase()){case"pdf":return _e;case"docx":case"odt":return me;case"png":case"jpg":case"jpeg":return he;default:return fe}}async function T(){const p=new FormData;a.value.forEach(l=>p.append("files[]",l));try{const l=await axios.post("/upload-files",p,{headers:{"Content-Type":"multipart/form-data"}});t("close-dialog"),c.success(l.data.message),a.value=[],window.location.reload()}catch(l){console.error(l),c.error("Upload failed!"),window.location.reload()}}return(p,l)=>(i(),r(v,null,[e("div",{onDragover:l[1]||(l[1]=w(()=>{},["prevent"])),onDragenter:l[2]||(l[2]=w(()=>{},["prevent"])),onDrop:w(h,["prevent"]),class:"border-2 border-dashed border-gray-400 p-6 rounded-lg text-center cursor-pointer"},[l[3]||(l[3]=e("p",null,"Drag and drop your files here, or click to select",-1)),e("input",{type:"file",multiple:"",ref:"fileInput",class:"hidden",onChange:s},null,544),e("button",{class:"mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition",onClick:l[0]||(l[0]=g=>p.$refs.fileInput.click())}," Select Files ")],32),e("div",ve,[(i(!0),r(v,null,D(a.value,(g,y)=>(i(),r("div",{key:y,class:"flex items-center p-4 bg-white rounded-lg shadow hover:shadow-lg transition gap-2 mb-3"},[e("div",we,[(i(),j(S(M(g)),{class:"w-6 h-6"}))]),e("div",xe,[e("p",ye,u(g.name),1),e("p",be,u((g.size/1024/1024).toFixed(2))+" MB",1)]),e("button",{onClick:Ae=>F(y),class:"text-red-500 ml-3 hover:text-red-700"}," ✕ ",8,ke)]))),128))]),e("button",{onClick:T,class:"mt-6 bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 transition",disabled:a.value.length===0}," Upload ",8,De)],64))}},Fe=x(Ce,[["__scopeId","data-v-84f634e3"]]),Me={class:"py-12"},Te={class:"mx-auto max-w-screen-xl sm:px-6 lg:px-8"},Be={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},je={class:"p-6 text-gray-900"},Se={class:"top-bar"},He={class:"search-upload-wrapper"},Ie={__name:"Dashboard",setup(n){const o=_(!1),c=_(""),a=_(null);H(o,d=>{d?a.value.showModal():a.value.close()});function t(){o.value=!1,a.value.close()}return(d,s)=>(i(),r(v,null,[m(b(I),{title:"Dashboard"}),m(U,null,{header:k(()=>[...s[2]||(s[2]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Your Files & Documents ",-1)])]),default:k(()=>[e("div",Me,[e("div",Te,[e("div",Be,[e("div",je,[e("div",Se,[e("div",He,[A(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=h=>c.value=h),placeholder:"Search files...",class:"search-input"},null,512),[[L,c.value]]),e("button",{onClick:s[1]||(s[1]=h=>o.value=!0),class:"btn-upload flex items-center gap-2",title:"Upload File"},[m(b(ge),{class:"w-5 h-5"}),s[3]||(s[3]=P(" Upload ",-1))])])]),e("dialog",{ref_key:"dialogRef",ref:a,class:"dialog-element rounded-lg p-6 w-1/2 relative shadow-lg"},[e("div",{class:"flex justify-between items-center mb-4"},[s[4]||(s[4]=e("h2",{class:"text-lg font-semibold"},"File Upload",-1)),e("button",{onClick:t,class:"text-gray-500 hover:text-gray-700"},"✕")]),m(Fe,{onCloseDialog:t}),e("div",{class:"flex justify-end gap-2 mt-4"},[e("button",{onClick:t,class:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300"}," Cancel ")])],512),m(ue,{"search-query":c.value},null,8,["search-query"])])])])])]),_:1})],64))}},Ee=x(Ie,[["__scopeId","data-v-a04f71ef"]]);export{Ee as default};
